// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema


generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid()) // ID unik user
  email     String   @unique // Email untuk login
  password  String // Password terenkripsi
  phone     String // Nomor HP untuk WhatsApp
  address   String? // Alamat opsional untuk delivery
  avatar    String? // Foto profil opsional
  name      String // Nama lengkap user
  role      UserRole @default(USER) // Role: USER atau ADMIN
  isActive  Boolean  @default(true) // Status aktif user
  lastLogin DateTime? // Waktu login terakhir
  createdAt DateTime @default(now()) // Waktu registrasi
  updatedAt DateTime @updatedAt // Waktu update terakhir

  orders Order[] // Relasi ke pesanan

  @@map("users")
}

model Category {
  id          String    @id @default(cuid()) // ID unik kategori
  name        String    @unique // Nama kategori (unique)
  description String? // Deskripsi kategori (opsional)
  createdAt   DateTime  @default(now()) // Waktu pembuatan
  updatedAt   DateTime  @updatedAt // Waktu update terakhir

  products Product[] // Relasi ke produk

  @@map("categories")
}

model Product {
  id          String   @id @default(cuid()) // ID unik produk
  name        String // Nama produk
  description String? // Deskripsi produk (opsional)
  price       Float // Harga default (ukuran M)
  image       String? // Gambar produk (opsional)
  stock       Int      @default(0) // Stok tersedia
  categoryId  String // ID kategori
  createdAt   DateTime @default(now()) // Waktu pembuatan
  updatedAt   DateTime @updatedAt // Waktu update terakhir

  category Category @relation(fields: [categoryId], references: [id], onDelete: Cascade) // Relasi ke kategori
  orderItems OrderItem[] // Relasi ke item pesanan

  @@map("products")
}

model Order {
  id         String   @id @default(cuid()) // ID unik order
  userId     String // ID user pemesan
  status     OrderStatus @default(PENDING) // Status order (enum OrderStatus)
  total      Float // Total harga pesanan
  orderType  OrderType @default(TAKEAWAY) // Tipe order (enum OrderType)
  queueNumber Int? // Nomor antrian (opsional)
  tableNumber Int? // Nomor meja (opsional untuk dine-in)
  notes      String? // Catatan khusus (opsional)
  createdAt  DateTime @default(now()) // Waktu pemesanan
  updatedAt  DateTime @updatedAt // Waktu update terakhir

  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade) // Relasi ke user
  orderItems OrderItem[] // Relasi ke item pesanan

  @@map("orders")
}

model OrderItem {
  id        String  @id @default(cuid()) // ID unik item order
  orderId   String // ID order
  productId String // ID produk
  quantity  Int // Jumlah item yang dipesan
  price     Float // Harga per item saat dipesan

  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade) // Relasi ke order
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade) // Relasi ke produk

  @@unique([orderId, productId]) // Unique constraint: 1 produk per order
  @@map("order_items")
}

// === ENUMS === //

// Role user: ADMIN atau USER biasa
enum UserRole {
  USER   // User biasa
  KASIR   // Kasir coffee shop
  MANAGER  // Manager coffee shop
}

// Status order: dari pending sampai selesai
enum OrderStatus {
  PENDING         // Menunggu pembayaran
  WAITING_PAYMENT // Menunggu konfirmasi bayar
  CONFIRMED       // Pembayaran dikonfirmasi
  PROCESSING      // Sedang dibuat
  READY          // Pesanan siap diambil
  COMPLETED      // Selesai
  CANCELLED      // Dibatalkan
}

// Tipe order: dibawa, makan di tempat, atau delivery
enum OrderType {
  TAKEAWAY  // Bawa pulang
  DINE_IN   // Makan di tempat
  DELIVERY  // Antar ke rumah
}

// Tipe produk: minuman, makanan, dessert
enum ProductType {
  DRINK    // Minuman
  FOOD     // Makanan
  SNACK    // Camilan
}

// Metode pembayaran: WhatsApp, tunai, COD
enum PaymentMethod {
  WHATSAPP  // Transfer via WhatsApp
  CASH      // Bayar tunai
  COD       // Cash on delivery
}

// === END ENUMS === //